- name: Get system Java home path
  shell: echo $JAVA_HOME
  register: java_home_output
  changed_when: false
  become: no

- name: Debug Java home path
  debug:
    msg: "Detected JAVA_HOME: {{ java_home_output.stdout }}"

- name: Verify Java home directory exists
  stat:
    path: "{{ java_home_output.stdout }}"
  register: java_home_check
  
- name: Debug Java home existence
  debug:
    msg: "Java home directory exists: {{ java_home_check.stat.exists }}"

- name: Forcefully remove bundled JDK directory
  file:
    path: "{{ nexus_installation_dir }}/jdk/termiun/jdk_17"
    state: absent
  become: yes
  register: removal_result

- name: Create symlink to system JDK
  file:
    src: "{{ java_home_output.stdout }}"
    dest: "{{ nexus_installation_dir }}/jdk/termiun/jdk_17"
    state: link
  become: yes
  when: java_home_check.stat.exists
